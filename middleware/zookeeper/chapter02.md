ZK
选举协议：ZAB，是选举过程和数据写入过程的基石。
ZAB的理解：所有事务请求是由一个全局唯一的服务器来协调处理，这个的服务器就是Leader服务器，
其它服务器都是Follower服务器或Observer服务器。Leader服务器负责将一个客户端的请求转换成那个一个事务Proposalͧ(提议)，将该Proposal分发给集群中所有的Follower服务器。然后Leader服务器需要等待所有Follower服务器的应答，当Leader服务器收到超过半数的Follower服务器进行了明确的应答后，Leader会再次向所有的Follower服务器分发Commit消息，要求其将前一个Proposal进行提交。

涉及到客户端对zk集群数据改变的行为都先由Leader统一响应，然后再把请求转换为事务转发给其他所有的Follower，Follower应答并处理事务，最后再反馈。如果客户端只是读请求，那么zk集群所有的节点都可以响应这个请求

ZAB协议三个阶段

1.发现(选举Leader过程)
2.同步(选出Leader后，Follower和Observer需进行数据同步)
3.广播(同步之后，集群对外工作响应请求，并进行消息广播，实现数据在集群节点的副本存储)

zk服务器角色

Leader
事务请求的唯一调度和处理者，保证集群事务处理的顺序序性
集群内部各服务器的调度者
Follower
处理客户端非事务请求，转发事务请求给Leader服务器
参与事务请求Proposal的投票
参与Leader的选举投票
Observer
处理客户端非事务请求，转发事务请求给Leader服务器
不参加任何形式的投票，包括选举和事务投票(超过半数确认)
Observer的存在是为了提高zk集群对外提供读性能的能力

zk服务器状态ServerState 类中定义ZK四种状态。
LOOKING
寻找Leader状态
当服务器处于这种状态时，表示当前没有Leader，需要进入选举流程
FOLLOWING
从机状态，表明当前服务器角色是Follower
OBSERVING
观察者状态，表明当前服务器角色是Observer
LEADING
领导者状态，表明当前服务器角色是Leader

集群机制：
zk集群的tcp连接顺序是1向2发起TCP连接，2向3发起TCP连接。

选举机制：


临时节点失效：可以设置timeout时期
